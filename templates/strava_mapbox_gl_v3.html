{% extends "base.html" %} {% block import_script %}
<!-- Mapbox GL -->
{% endblock %} {% block content %}
<!-- Sidebar -->
<div id="container">
    <div id="sidebar">
        <div class="sidebar-wrapper">
            <div class="panel panel-default" id="features">
                <div class="panel-heading">
                    <h3 class="panel-title">Designer Toolbar</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-xs-8 col-md-8">
                            <button type="submit" id='snap' class="btn btn-success" data-toggle="modal" data-target="#SaveDesign">Save Design</button>
                            <br>
                            <div id="spinner"></div>
                            <br>
                            <br>
                            <b>Viz Type</b>
                            <select id='VizType' name="VizType" style="font-size: 20px;">
                                <option value="heat-point">heat-point</option>
                                <option value="heat-line">heat-line</option>
                                <option value="segment">Segments++</option>
                                <option value="elevation">3D (Desktop only)</option>
                            </select>
                            <br>
                            <br>
                            <b>Map Style</b>
                            <select id='mapStyle' name="mapStyle" value="dark" style="font-size: 20px;">
                                <option value="dark-nolabel">Dark v1</option>
                                <option value="dark">Dark v2</option>
                                <option value="outdoors">Outdoors</option>
                                <option value="streets">Streets</option>
                                <option value="light">Light</option>
                                <option value="satellite-streets">Satellite-Lines</option>
                            </select>
                            <br>
                            <br>
                            <b>Map Pitch</b>
                            <input type="text" id="pitch" class="slider" data-slider-min="0" data-slider-value="0" data-slider-max="60" data-slider-step="5">
                            <br>
                            <br>
                            <div id="VizType_hide_segment" class="collapse">
                                <!--<button type="submit" id='updateSeg' class="btn btn-primary">Get New Segments</button>
                                <p>Wait ~10 seconds </p>!-->
                                <b>Segment Type</b>
                                <select id='segType' name="segType" value="riding" style="font-size: 20px;">
                                    <option value="riding">Cycling</option>
                                    <option value="running">Running</option>
                                </select>
                                <br>
                                <br>
                                <b> Distance Filter (mi) </b>
                                <input id="dist_filter" type="text" class="slider" value="" data-slider-min="0" data-slider-max="30" data-slider-step="1" data-slider-value="[0,30]" data-slider-id='dist_filter_slider' onclick="render()">
                                <br>
                                <br>
                                <b>Segment Parameter</b>
                                <select id='segParam' name="line_color" style="font-size: 18px;">
                                    <option value="ELEV_GAIN">Elev Gain (m)</option>
                                    <option value="EFFORT_COUNT">Total Efforts</option>
                                    <option value="ATH_CNT">Total Athletes</option>
                                    <option value="AVG_GRADE">Avg Gradient (%)</option>
                                </select>
                                <br>
                                <br>
                                <b>Segment Scale</b>
                                <input type="text" id="segScale" class="slider" data-slider-min="1" data-slider-value="500" data-slider-max="5000" data-slider-step="1">
                                <br>
                                <br>
                            </div>
                            <div id="VizType_hide_heat-line" class="collapse">
                                <b>Line Color</b>
                                <select id='line_color' name="line_color" style="font-size: 18px;">
                                    <option value=0>Teal-Pink-Green</option>
                                    <option value=1>Red-Ora-Blu</option>
                                    <option value=2>Yellows</option>
                                    <option value=3>Greens</option>
                                    <option value=4>Reds</option>
                                </select>
                                <br>
                                <br>
                                <b> Line Width </b>
                                <input id="line_width" class="slider" data-slider-id='line_width_slider' type="text" data-slider-min="0.5" data-slider-value="2" data-slider-max="6" data-slider-step="0.5" onclick="render()">
                                <br>
                                <br>
                                <b>Line Opacity</b>
                                <input type="text" class="slider" id="line_opacity" data-slider-min="0.1" data-slider-value="0.8" data-slider-max="1" data-slider-step="0.1" onclick="render()">
                                <br>
                                <br>
                                <b>Line Offset</b>
                                <input type="text" class="slider" id="line_offset" data-slider-min="0" data-slider-value="0" data-slider-max="10" data-slider-step="1" onclick="render()">
                            </div>
                            <div id="VizType_hide_heat-point" class="collapse in">
                                <b>Heat Parameter</b>
                                <select id='heattype' name="line_color" style="font-size: 18px;">
                                    <option value="s">Speed (mph)</option>
                                    <option value="d">Density (freq)</option>
                                    <option value="g">Grade (%)</option>
                                    <option value="p">Power (watts)</option>
                                    <option value="e">Elevation (ft)</option>
                                    <option value="h">Heartrate (BPM)</option>
                                    <option value="c">Cadence (RPM)</option>
                                </select>
                                <br>
                                <br>
                                <b>Heat Color</b>
                                <select id='heat_color' name="heat_color" style="font-size: 18px;">
                                    <option value="0">Blu-Gre-Yel-Red</option>
                                    <option value="1">Pur-Blu-Yel-Ora</option>
                                    <option value="2">Gre-Red</option>
                                </select>
                                <br>
                                <br>
                                <b>Heat Scale</b>
                                <input type="text" id="scale" class="slider" data-slider-min="1" data-slider-value="28" data-slider-max="35" data-slider-step="1">
                                <br>
                                <br>
                                <b>Heat Blur</b>
                                <input type="text" id="blur" class="slider" data-slider-min="0" data-slider-value="0.5" data-slider-max="5" data-slider-step="0.25">
                                <br>
                                <br>
                                <b>Heat Radius</b>
                                <input type="text" id="radius" class="slider" data-slider-min="1" data-slider-value="2" data-slider-max="10" data-slider-step="0.5">
                                <br>
                                <br>
                                <b>Heat Opacity</b>
                                <input type="text" id="minOpacity" class="slider" data-slider-min="0.2" data-slider-value="1" data-slider-max="1" data-slider-step="0.1">
                                <br>
                                <br>
                            </div>
                            <div id="VizType_hide_elevation" class="collapse">
                                <b>Fill Color</b>
                                <select id='fill_color' name="fill_color" style="font-size: 18px;">
                                    <option value=0>Blue-Red</option>
                                    <option value=1>Green-Red</option>
                                    <option value=2>Purples</option>
                                </select>
                                <br>
                                <br>
                                <b>Fill Opacity</b>
                                <input type="text" class="slider" id="fill_opacity" data-slider-min="0.1" data-slider-value="0.9" data-slider-max="1" data-slider-step="0.1">
                                <br>
                                <br>
                                <b>Fill Height</b>
                                <input type="text" class="slider" id="fill_height" data-slider-min="0" data-slider-value="5000" data-slider-max="15000" data-slider-step="50">
                                <br>
                                <br>
                                <b>Fill Color Scale</b>
                                <input type="text" class="slider" id="fill_color_scale" data-slider-min="0" data-slider-value="5000" data-slider-max="15000" data-slider-step="25">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id='map'></div>
    <a class='pin-bottomleft z1 pad1' target='_blank' href='https://www.mapbox.com/'>
        <img src='data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgeD0iMCIgeT0iMCIgd2lkdGg9IjU5LjEiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCA1OS4xIDE4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1OS4xMTkgMTgiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGQ9Ik0xLjQgMEMwLjYgMC4xIDAgMC44IDAgMS41TDAgMTMuNEMwIDE0LjIgMC43IDE0LjggMS41IDE0LjhMMy4zIDE0LjhDNCAxNC44IDQuNyAxNC4yIDQuOCAxMy40TDQuOCA5LjEgNS41IDEwLjNDNiAxMS4yIDcuNSAxMS4yIDggMTAuM0w4LjggOS4xIDguOCAxMy40QzguOCAxNC4xIDkuNSAxNC44IDEwLjIgMTQuOEwxMiAxNC44QzEyLjggMTQuOCAxMy41IDE0LjIgMTMuNSAxMy40TDEzLjUgMTMuMkMxNC41IDE0LjMgMTUuOSAxNSAxNy42IDE1TDIxLjcgMTUgMjEuNyAxNi41QzIxLjcgMTcuMyAyMi4zIDE4IDIzLjEgMThMMjQuOSAxOEMyNS43IDE4IDI2LjQgMTcuMyAyNi40IDE2LjVMMjYuNCAxNUMyOC4xIDE1IDI5LjUgMTQuNCAzMC41IDEzLjNMMzAuNSAxMy41QzMwLjUgMTMuOSAzMC43IDE0LjMgMzEgMTQuNiAzMS4zIDE0LjkgMzEuNiAxNSAzMiAxNUwzNS4zIDE1QzM3LjQgMTUgMzkuMiAxNCA0MC4zIDEyLjMgNDEuMyAxMy45IDQzLjEgMTUgNDUuMSAxNSA0Ni4yIDE1IDQ3LjEgMTQuOCA0Ny45IDE0LjMgNDguMiAxNC42IDQ4LjcgMTQuOCA0OS4xIDE0LjhMNTEuMyAxNC44QzUxLjcgMTQuOCA1Mi4yIDE0LjYgNTIuNSAxNC4yTDUzLjQgMTIuOSA1NC4zIDE0LjJDNTQuNiAxNC42IDU1LjEgMTQuOCA1NS41IDE0LjhMNTcuNyAxNC44QzU4LjggMTQuOCA1OS41IDEzLjQgNTguOSAxMi41TDU2LjMgOC45IDU4LjcgNS41QzU5LjQgNC42IDU4LjYgMy4xIDU3LjUgMy4xTDU1LjMgMy4xQzU0LjkgMy4xIDU0LjQgMy40IDU0LjEgMy44TDUzLjQgNC44IDUyLjcgMy44QzUyLjQgMy40IDUxLjkgMy4xIDUxLjQgMy4xTDQ5LjMgMy4xQzQ4LjggMy4xIDQ4LjMgMy40IDQ4IDMuOCA0Ny4yIDMuMyA0Ni4yIDMgNDUuMSAzIDQzLjEgMyA0MS4zIDQuMSA0MC4yIDUuNyAzOS4yIDQgMzcuNCAzIDM1LjMgM0wzNS4zIDEuNUMzNS4zIDEuMSAzNS4xIDAuNyAzNC44IDAuNCAzNC42IDAuMiAzNC4yIDAgMzMuOCAwTDMyIDBDMzEuMyAwIDMwLjUgMC44IDMwLjUgMS41TDMwLjUgNC43QzI5LjUgMy42IDI4LjEgMyAyNi41IDNMMjMuMSAzQzIyLjQgMyAyMS43IDMuNyAyMS43IDQuNUwyMS43IDQuOEMyMC42IDMuNyAxOS4yIDMgMTcuNiAzIDE1LjkgMyAxNC41IDMuNyAxMy41IDQuOEwxMy41IDEuNUMxMy41IDAuNyAxMi44IDAgMTIgMEwxMC42IDBDOS42IDAgOC40IDAuNCA3LjggMS40TDYuOCAzLjEgNS44IDEuNEM1LjEgMC40IDMuOSAwIDIuOSAwTDEuNSAwIDEuNCAwek0xLjUgMS41TDIuOSAxLjVDMy42IDEuNSA0LjIgMS43IDQuNSAyLjJMNi44IDYuMSA5IDIuMkM5LjMgMS43IDkuOSAxLjUgMTAuNiAxLjVMMTIgMS41IDEyIDEzLjUgMTAuMiAxMy41IDEwLjIgMy42IDYuOCA5LjUgMy4zIDMuNiAzLjMgMTMuNSAxLjUgMTMuNSAxLjUgMS41ek0zMi4xIDEuNUwzMy44IDEuNSAzMy44IDQuNUMzNC40IDQuNSAzNC44IDQuNSAzNS4zIDQuNSAzNy44IDQuNSAzOS43IDYuNCAzOS43IDkgMzkuNyAxMS42IDM3LjggMTMuNSAzNS4zIDEzLjVMMzIuMSAxMy41IDMyLjEgMS41ek0xNy42IDQuNUMyMCA0LjUgMjEuOCA2LjQgMjEuOCA5TDIxLjggMTMuNSAxNy42IDEzLjVDMTUuMSAxMy41IDEzLjQgMTEuNiAxMy40IDkgMTMuNCA2LjQgMTUuMSA0LjUgMTcuNiA0LjV6TTQ1LjEgNC41QzQ3LjUgNC41IDQ5LjUgNi41IDQ5LjUgOSA0OS41IDExLjUgNDcuNSAxMy41IDQ1LjEgMTMuNSA0Mi43IDEzLjUgNDAuNyAxMS41IDQwLjcgOSA0MC43IDYuNSA0Mi43IDQuNSA0NS4xIDQuNXpNMjMuMSA0LjVMMjYuNSA0LjVDMjguOSA0LjUgMzAuOCA2LjQgMzAuOCA5IDMwLjggMTEuNiAyOC45IDEzLjUgMjYuNSAxMy41TDI0LjkgMTMuNSAyNC45IDE2LjUgMjMuMSAxNi41IDIzLjEgNC41ek00OS4zIDQuNUw1MS40IDQuNSA1My40IDcuMyA1NS4zIDQuNSA1Ny41IDQuNSA1NC41IDguOSA1Ny43IDEzLjUgNTUuNSAxMy41IDUzLjQgMTAuNCA1MS4yIDEzLjUgNDkuMSAxMy41IDUyLjMgOC45IDQ5LjMgNC41ek0xNy42IDYuMkMxNi4yIDYuMiAxNS4xIDcuNCAxNS4xIDkgMTUuMSAxMC42IDE2LjIgMTEuOCAxNy42IDExLjhMMjAgMTEuOCAyMCA5QzIwIDcuNCAxOSA2LjIgMTcuNiA2LjJ6TTQ1LjEgNi4yQzQzLjcgNi4yIDQyLjUgNy41IDQyLjUgOSA0Mi41IDEwLjUgNDMuNyAxMS44IDQ1LjEgMTEuOCA0Ni42IDExLjggNDcuNyAxMC41IDQ3LjcgOSA0Ny43IDcuNSA0Ni42IDYuMiA0NS4xIDYuMnpNMjQuOSA2LjNMMjQuOSAxMS44IDI2LjUgMTEuOEMyNy45IDExLjggMjkuMSAxMC41IDI5LjEgOSAyOS4xIDcuNSAyOC4xIDYuMyAyNi41IDYuM0wyNC45IDYuM3pNMzMuOCA2LjNMMzMuOCAxMS44IDM1LjMgMTEuOEMzNi45IDExLjggMzggMTAuNSAzOCA5IDM4IDcuNSAzNi44IDYuMyAzNS4zIDYuM0wzMy44IDYuM3pNMTcuNiA3LjdDMTguMSA3LjcgMTguNSA4LjEgMTguNSA5TDE4LjUgMTAuMyAxNy42IDEwLjNDMTcgMTAuMyAxNi42IDkuOSAxNi42IDkgMTYuNiA4LjEgMTcgNy43IDE3LjYgNy43ek0yNi40IDcuN0MyNy4yIDcuNyAyNy42IDguNCAyNy42IDkgMjcuNiA5LjkgMjYuOSAxMC4zIDI2LjQgMTAuM0wyNi40IDcuN3pNMzUuMSA3LjdDMzUuOCA3LjcgMzYuNSA4LjMgMzYuNSA5IDM2LjUgOS44IDM1LjkgMTAuMyAzNS4xIDEwLjNMMzUuMSA3Ljd6TTQ1LjEgNy43QzQ1LjcgNy43IDQ2LjIgOC4yIDQ2LjIgOSA0Ni4yIDkuOCA0NS43IDEwLjMgNDUuMSAxMC4zIDQ0LjUgMTAuMyA0NCA5LjggNDQgOSA0NCA4LjIgNDQuNSA3LjcgNDUuMSA3Ljd6IiBvcGFjaXR5PSIwLjMiLz48cGF0aCBkPSJtMS41IDEuNSAwIDEyIDEuOCAwIDAtOS45IDMuNSA1LjkgMy41LTUuOSAwIDkuOSAxLjggMCAwLTEyLTEuNCAwQzkuOSAxLjUgOS4zIDEuNyA5IDIuMkw2LjggNi4xIDQuNSAyLjJDNC4yIDEuNyAzLjYgMS41IDIuOSAxLjVMMS41IDEuNVptMzAuNiAwIDAgMTIgMy4zIDBjMi40IDAgNC40LTEuOSA0LjQtNC41IDAtMi42LTEuOS00LjUtNC40LTQuNS0wLjUgMC0wLjkgMC0xLjUgMGwwLTMtMS43IDB6TTE3LjYgNC41Yy0yLjQgMC00LjIgMS45LTQuMiA0LjUgMCAyLjYgMS44IDQuNSA0LjIgNC41bDQuMiAwTDIxLjggOWMwLTIuNi0xLjctNC41LTQuMi00LjV6bTI3LjYgMGMtMi40IDAtNC40IDItNC40IDQuNSAwIDIuNSAyIDQuNSA0LjQgNC41IDIuNCAwIDQuMy0yIDQuMy00LjUgMC0yLjUtMS45LTQuNS00LjMtNC41em0tMjIgMCAwIDEyIDEuOCAwIDAtMyAxLjYgMGMyLjQgMCA0LjMtMS45IDQuMy00LjUgMC0yLjYtMS45LTQuNS00LjMtNC41bC0zLjMgMHptMjYuMiAwIDMgNC40LTMuMiA0LjYgMi4xIDAgMi4yLTMuMSAyLjEgMy4xIDIuMiAwTDU0LjUgOC45IDU3LjUgNC41IDU1LjMgNC41IDUzLjQgNy4zIDUxLjQgNC41IDQ5LjMgNC41Wk0xNy42IDYuMkMxOSA2LjIgMjAgNy40IDIwIDlsMCAyLjgtMi40IDBjLTEuNCAwLTIuNC0xLjItMi40LTIuOCAwLTEuNiAxLTIuOCAyLjQtMi44em0yNy42IDBjMS40IDAgMi42IDEuMiAyLjYgMi44IDAgMS41LTEuMiAyLjgtMi42IDIuOEM0My43IDExLjggNDIuNSAxMC41IDQyLjUgOWMwLTEuNSAxLjItMi44IDIuNi0yLjh6bS0yMC4yIDAgMS42IDBjMS42IDAgMi42IDEuMyAyLjYgMi44IDAgMS41LTEuMSAyLjgtMi42IDIuOGwtMS42IDAgMC01LjV6bTkgMCAxLjUgMGMxLjUgMCAyLjYgMS4zIDIuNiAyLjggMCAxLjUtMSAyLjgtMi42IDIuOGwtMS41IDAgMC01LjV6IiBmaWxsPSIjZmZmIi8+PC9zdmc+' alt='Mapbox' />
    </a>
    <div class='legend-container'>
        <div id='legend-points' class='legend'>
            <h3><b>Legend</b></h3>
            <span id='legend-points-param' class='text-center'><b>Speed (mph)</b></span>
        </div>
        <div id='legend-lines' class='legend' style="display:none;">
            <h3><b>Legend</b></h3>
            <span id='legend-lines-param' class='text-center'><b>Activity Type</b></span>
        </div>
        <div id='legend-seg' class='legend' style="display:none;">
            <h3><b>Legend</b></h3>
            <span id='legend-seg-param' class='text-center'><b>Segment Value</b></span>
        </div>
        <div id='legend-elevation' class='legend' style="display:none;">
            <h3><b>Legend</b></h3>
            <span id='legend-elev-param' class='text-center'><b>Elevation Value</b></span>
        </div>
    </div>
    <div id="loading">
        <div class="loading-indicator">
            <div class="progress progress-striped active">
                <div class="progress-bar progress-bar-info progress-bar-full">
                    <strong>Warming up the ADV viz pipes! </strong>
                </div>
            </div>
        </div>
    </div>
    <div id="loading-segs">
        <div class="loading-indicator">
            <div class="progress progress-striped active" style="display:none;">
                <div class="progress-bar progress-bar-info progress-bar-full">
                    <strong>Getting new segments in map area! </strong>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="SaveDesign" role="dialog" tabindex="-1" aria-labelledby="SaveDesign">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center">Your Athlete Data Viz creation</h3>
                </div>
                <div class="modal-body">
                    <div id='snapshot'></div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div id="img_display" class="text-center">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Try a new Design</button>
                            <a type="button" id="download_viz" class="btn btn-default" href="">Download </a>
                            <a type="button" id="img_share_url" class="btn btn-default">Share Link </a>
                        </div>
                    </div>
                    <br>
                    <div class="row text-center">
                        <div id="loading_social" class="progress center-block">
                            <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%; height: 19px;">
                                <span> Generating high-rez viz to order and share! ... </span>
                            </div>
                        </div>
                        <div id="social" class="text-center">
                            <h4> Order and Share your Design! </h4>
                            <div class="my-product-grid">
                                <div class="my-product-row">
                                    <div data-accent_color="767676" data-background_color="ffffff" data-button_background_color="7fb466" data-button_text_color="ffffff" data-cart_button_text="Cart" data-cart_title="Your cart" data-cart_total_text="Total" data-checkout_button_text="Checkout" data-discount_notice_text="Shipping and discount codes are added at checkout." data-embed_type="cart" data-empty_cart_text="Your cart is empty." data-shop="athletedataviz.myshopify.com" data-sticky="true" data-text_color="000000"></div>
                                    <div data-background_color="ffffff" data-button_background_color="7fb466" data-button_text_color="ffffff" data-buy_button_out_of_stock_text="Out of Stock" data-buy_button_product_unavailable_text="Unavailable" data-buy_button_text="Buy Prints" data-collection_handle="frontpage" data-display_size="compact" data-embed_type="collection" data-has_image="true" data-next_page_button_text="Next page" data-product_handle="" data-product_modal="true" data-product_name="" data-product_title_color="000000" data-redirect_to="modal" data-shop="athletedataviz.myshopify.com"></div>
                                    <script type="text/javascript">
                                    document.getElementById('ShopifyEmbedScript') || document.write('<script type="text/javascript" src="https://widgets.shopifyapps.com/assets/widgets/embed/client.js" id="ShopifyEmbedScript"><\/script>');
                                    </script>
                                </div>
                            </div>
                            <!-- Shares -->
                            <a id="share_fb" class="btnz share facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://athletedataviz.com" target="_blank"><i class="fa fa-facebook text-center"></i> Share</a>
                            <a id="share_gplus" class="btnz share gplus" href="https://plus.google.com/share?url=https://athletedataviz.com"><i class="fa fa-google-plus text-center" target="_blank"></i> Share</a>
                            <a id="share_twit" class="btnz share twitter" href="https://twitter.com/home?status=Check%20out%20custom%20designs%20at%20www.athletedataviz.com" target="_blank"><i class="fa fa-twitter text-center"></i> Tweet</a>
                            <a id="share_pin" class="btnz share pinterest" href="https://pinterest.com/pin/create/button/?url=https://athletedataviz.com&media=https%3A//athletedataviz.com/static/img/title_gallery_3.jpg&description=Check%20out%20my%20custom%20design!" target="_blank"><i class="fa fa-pinterest text-center"></i> Pin it</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Map Designer Time! -->
    <script>
    var domReady = function(callback) {
        document.readyState === "interactive" || document.readyState === "complete" ? callback() : document.addEventListener("DOMContentLoaded", callback);
    };

    //initialize variables from server
    var center_point = [-89.6075530123, 40.776876321];
    var bbox_url = '{{ bbox_url | safe}}';
    var evelpoly_url = '{{ evelpoly_url | safe}}';
    var seg_base_url = '{{ seg_base_url | safe}}';
    var heatpoint_url = '{{ heatpoint_url | safe}}';
    var heatline_url = '{{ heatline_url | safe}}';
    var mapboxgl_accessToken = '{{ mapbox_gl_accessToken|safe }}';
    var ath_name = '{{ath_name}}';

    function copyToClipboard(text) {
        window.prompt("A link to your AthleteDataViz design:", text);
    }

    domReady(function() {
        initVizMap();

        $('#VizType').change(function() {
            var selector = '#VizType_hide_' + $(this).val();
            if (document.getElementById("VizType").value == "segment") {
                $(selector).collapse('show');
                $('#VizType_hide_heat-line').collapse('hide');
                $('#VizType_hide_heat-point').collapse('hide');
                $('#VizType_hide_elevation').collapse('hide');
            } else if (document.getElementById("VizType").value == "heat-line") {
                $(selector).collapse('show');
                $('#VizType_hide_elevation').collapse('hide');
                $('#VizType_hide_heat-point').collapse('hide');
                $('#VizType_hide_segment').collapse('hide');
            } else if (document.getElementById("VizType").value == "elevation") {
                $(selector).collapse('show');
                $('#VizType_hide_heat-line').collapse('hide');
                $('#VizType_hide_heat-point').collapse('hide');
                $('#VizType_hide_segment').collapse('hide');
            } else {
                $(selector).collapse('show');
                $('#VizType_hide_heat-line').collapse('hide');
                $('#VizType_hide_elevation').collapse('hide');
                $('#VizType_hide_segment').collapse('hide');
            }
        });

        $('#updateSeg').on('click touch tap', function(event) {
            isMapLoaded(map, 300, 'url');
            addSegLayer(map, getURL(map, 'True'));
            render();
        });

        $('#segType').change(function(event) {
            addSegLayer(map, getURL(map, 'False'));
            render();
        });

        $('#pitch').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#pitch').slider().on('slide', function(ev) {
            $('#pitch').slider('setValue', ev.value);
            render();
        });
        $('#dist_filter').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#dist_filter').slider().on('slideStop', function(ev) {
            $('#dist_filter').slider('setValue', ev.value);
            addSegLayer(map, getURL(map, 'False'));
            render();
        });
        $('#line_width').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#line_width').slider().on('slide', function(ev) {
            $('#line_width').slider('setValue', ev.value);
            render();
        });
        $('#line_opacity').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#line_opacity').slider().on('slide', function(ev) {
            $('#line_opacity').slider('setValue', ev.value);
            render();
        });
        $('#line_offset').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#line_offset').slider().on('slide', function(ev) {
            $('#line_offset').slider('setValue', ev.value);
            render();
        });
        $('#blur').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#blur').slider().on('slide', function(ev) {
            $('#blur').slider('setValue', ev.value);
            render();
        });
        $('#radius').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#radius').slider().on('slide', function(ev) {
            $('#radius').slider('setValue', ev.value);
            render();
        });
        $('#segScale').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#segScale').slider().on('slideStop', function(ev) {
            $('#segScale').slider('setValue', ev.value);
            render();
        });
        $('#scale').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#scale').slider().on('slideStop', function(ev) {
            $('#scale').slider('setValue', ev.value);
            render();
        });
        $('#minOpacity').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#minOpacity').slider().on('slide', function(ev) {
            $('#minOpacity').slider('setValue', ev.value);
            render();
        });
        $('#fill_opacity').slider().on('slideStop', function(ev) {
            $('#fill_opacity').slider('setValue', ev.value);
            render();
        });
        $('#fill_opacity').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#fill_height').slider().on('slideStop', function(ev) {
            $('#fill_height').slider('setValue', ev.value);
            render();
        });
        $('#fill_height').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#fill_color_scale').slider({
            formatter: function(value) {
                return 'Value: ' + value;
            }
        });
        $('#fill_color_scale').slider().on('slideStop', function(ev) {
            $('#fill_color_scale').slider('setValue', ev.value);
            render();
        });


        $('#heat_color').change(render);
        $('#VizType').change(render);
        $('#mapStyle').change(switchLayer);
        $('#heattype').change(render);
        $('#segParam').change(render);
        $('#heat_color').change(render);
        $('#fill_color').change(render);
        $('#line_color').change(render);
        $('#snap').on('click touch tap', generateMap);

        $("#sidebar-toggle-btn").click(function() {
            $("#sidebar").toggle();
            map.resize();
            return false;
        });

        $("#sidebar-hide-btn").click(function() {
            $('#sidebar').hide();
            map.resize();
            return false;
        });

        $("#img_share_url").click(function() {
            copyToClipboard(imgurl);
        });

    });
    </script>
    {% endblock %}
