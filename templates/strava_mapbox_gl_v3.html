{% extends "base.html" %} {% block import_script %}
<!-- Mapbox GL -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.14.1/mapbox-gl.js' ></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.14.1/mapbox-gl.css' rel='stylesheet' >
<!-- Bootstrap Slider -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/5.2.5/css/bootstrap-slider.min.css" async defer>
<script src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/5.2.5/bootstrap-slider.min.js' async defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.touchswipe/1.6.15/jquery.touchSwipe.min.js" async></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.1.0/js/canvas-to-blob.min.js" async defer></script>
<script src='https://api.mapbox.com/mapbox.js/plugins/geojson-extent/v0.0.1/geojson-extent.js' async defer></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/filesaver.js/0.2/FileSaver.min.js" async defer></script>


{% endblock %} {% block content %}
<!-- Sidebar -->
<div id="container">
    <div id="sidebar">
        <div class="sidebar-wrapper">
            <div class="panel panel-default" id="features">
                <div class="panel-heading">
                    <h3 class="panel-title">Designer Toolbar</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-xs-8 col-md-8">
                            <button type="submit" id='snap' class="btn btn-primary" data-toggle="modal" data-target="#SaveDesign">Save Design</button>
                            <br>
                            <div id="spinner"></div>
                            <br>
                            <br>
                            <b>Viz Type</b>
                            <select id='VizType' name="VizType" style="font-size: 20px;">
                                <option value="heat-point">heat-point</option>
                                <option value="heat-line">heat-line</option> 
                            </select>
                            <br>
                            <br>
                            <b>Map Style</b>
                            <select id='mapStyle' name="mapStyle" value="dark" style="font-size: 20px;">
                                <option value="dark-nolabel">Dark: no Label</option>
                                <option value="dark">Dark: Label</option>
                                <option value="basic">Basic</option>
                                <option value="streets">Streets</option>
                                <option value="emerald">Emerald</option>
                                <option value="bright">Bright</option>
                                <option value="light">Light</option>
                                <option value="satellite">Satellite</option>
                            </select>
                            <br>
                            <br>
                            <b>Map Pitch</b>
                                <input type="text" id="pitch" class="slider" data-slider-min="0" data-slider-value="0" data-slider-max="50" data-slider-step="5">
                            <br>
                            <br>
                            <div id="VizType_hide_heat-line" class="collapse">
                                <b>Line Color</b>
                                <select id='line_color' name="line_color" style="font-size: 18px;">
                                    <option value=0>Teal-Pink-Green</option>
                                    <option value=1>Red-Ora-Blu</option>
                                    <option value=2>Yellows</option>
                                    <option value=3>Greens</option>
                                    <!--
                                    <option value="#FFFF00">Dark Yellow</option>
                                    <option value="#0000FF">Dark Blue</option>
                                    <option value="#9900FF">Dark Purple</option>
                                    <option value="#FF0099">Light Pink</option>
                                    <option value="#00CCFF">Light Blue</option>
                                    <option value="#33FF00">Light Green</option>
                                    <option value="#FF9900">Light Orange</option>
                                    -->
                                </select>
                                <br>
                                <br>
                                <b> Line Width </b>
                                <input id="line_width" class="slider" data-slider-id='line_width_slider' type="text" data-slider-min="0.5" data-slider-value="2" data-slider-max="6" data-slider-step="0.5" onclick="render()">
                                <br>
                                <br>
                                <b>Line Opacity</b>
                                <input type="text" class="slider" id="line_opacity" data-slider-min="0.1" data-slider-value="0.5" data-slider-max="1" data-slider-step="0.1" onclick="render()">
                                <br>
                                <br>
                                <b>Line Offset</b>
                                <input type="text" class="slider" id="line_offset" data-slider-min="0" data-slider-value="0" data-slider-max="10" data-slider-step="1" onclick="render()">
                            </div>
                            <div id="VizType_hide_heat-point" class="collapse in">
                                <b>Heat Parameter</b>
                                <select id='heattype' name="line_color" style="font-size: 18px;">
                                    <option value="s">Speed (mph)</option>
                                    <option value="d">Density (freq)</option>
                                    <option value="g">Grade (%)</option>
                                </select>
                                <br>
                                <br>
                                <b>Heat Color</b>
                                <select id='heat_color' name="heat_color" style="font-size: 18px;">
                                    <option value="0">Blu-Gre-Yel-Red</option>
                                    <option value="1">Pur-Blu-Yel-Ora</option>
                                    <option value="2">Gre-Red</option>
                                </select>
                                <br>
                                <br>
                                <b>Heat Scale</b>
                                <input type="text" id="scale" class="slider" data-slider-min="2.5" data-slider-value="15" data-slider-max="20" data-slider-step="2.5">
                                <br>
                                <br>
                                <b>Heat Blur</b>
                                <input type="text" id="blur" class="slider" data-slider-min="0" data-slider-value="0.5" data-slider-max="2" data-slider-step="0.25">
                                <br>
                                <br>
                                <b>Heat Radius</b>
                                <input type="text" id="radius" class="slider" data-slider-min="1" data-slider-value="2" data-slider-max="10" data-slider-step="1">
                                <br>
                                <br>
                                <b>Heat Opacity</b>
                                <input type="text" id="minOpacity" class="slider" data-slider-min="0.2" data-slider-value="0.8" data-slider-max="1" data-slider-step="0.2">
                                <br>
                                <br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id='map'></div>
    <div class='legend-container'>
      <div id='legend-points' class='legend'>
        <h3>Legend</h3>
        <span id='legend-points-param' class='text-center'><b>Speed (mph)</b></span>
      </div>
      <div id='legend-lines' class='legend'>
        <h3>Legend</h3>
        <span id='legend-lines-param' class='text-center' hidden="true"><b>Activity Type</b></span>
      </div>
    </div>
    <div id="loading">
        <div class="loading-indicator">
            <div class="progress progress-striped active">
                <div class="progress-bar progress-bar-info progress-bar-full">
                    <strong>Warming up the ADV viz pipes! </strong>
                </div>
    
            </div>
        </div>
    </div>
    <div class="modal fade" id="SaveDesign" role="dialog" tabindex="-1" aria-labelledby="SaveDesign">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title text-center">Your Athlete Data Viz creation</h3>
                </div>
                <div class="modal-body">
                    <div id='snapshot'></div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div id="img_display" class="text-center">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Try a new Design</button>
                            <a type="button" id="download_viz"   class="btn btn-default" href="" >Download </a>
                            <a type="button" id="img_share_url" class="btn btn-default">Share Link </a>
                        </div>
                    </div>
                    <br>
                    <div class="row text-center">
                        <div id="loading_social" class="progress center-block"> 
                            <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%; height: 19px;">
                                <span> Generating high-rez viz to order and share! ... </span>
                            </div>
                        </div>
                        <div id="social" class="text-center">
                            <h4> Order and Share your Design! </h4>
                            <div class="my-product-grid">
                                <div class="my-product-row">
                                    <div data-accent_color="767676" data-background_color="ffffff" data-button_background_color="7fb466" data-button_text_color="ffffff" data-cart_button_text="Cart" data-cart_title="Your cart" data-cart_total_text="Total" data-checkout_button_text="Checkout" data-discount_notice_text="Shipping and discount codes are added at checkout." data-embed_type="cart" data-empty_cart_text="Your cart is empty." data-shop="athletedataviz.myshopify.com" data-sticky="true" data-text_color="000000"></div>
                                    <div data-background_color="ffffff" data-button_background_color="7fb466" data-button_text_color="ffffff" data-buy_button_out_of_stock_text="Out of Stock" data-buy_button_product_unavailable_text="Unavailable" data-buy_button_text="Buy Prints" data-collection_handle="frontpage" data-display_size="compact" data-embed_type="collection" data-has_image="true" data-next_page_button_text="Next page" data-product_handle="" data-product_modal="true" data-product_name="" data-product_title_color="000000" data-redirect_to="modal" data-shop="athletedataviz.myshopify.com"></div>
                                    <script type="text/javascript">document.getElementById('ShopifyEmbedScript') || document.write('<script type="text/javascript" src="https://widgets.shopifyapps.com/assets/widgets/embed/client.js" id="ShopifyEmbedScript"><\/script>');</script>
                                </div>
                            </div>
                                <!-- Shares -->
                                <a id="share_fb" class="btnz share facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://athletedataviz.com" target="_blank"><i class="fa fa-facebook text-center"></i> Share</a>
                                <a id="share_gplus" class="btnz share gplus" href="https://plus.google.com/share?url=https://athletedataviz.com"><i class="fa fa-google-plus text-center" target="_blank"></i> Share</a>
                                <a id="share_twit" class="btnz share twitter" href="https://twitter.com/home?status=Check%20out%20custom%20designs%20at%20www.athletedataviz.com" target="_blank"><i class="fa fa-twitter text-center"></i> Tweet</a>
                                <a id="share_pin" class="btnz share pinterest" href="https://pinterest.com/pin/create/button/?url=https://athletedataviz.com&media=https%3A//athletedataviz.com/static/img/title_gallery_3.jpg&description=Check%20out%20my%20custom%20design!" target="_blank"><i class="fa fa-pinterest text-center"></i> Pin it</a>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Designer Time! -->
    <script>
    //initialize variables from server
    try {
    var center_point = [-89.6075530123, 40.776876321];
    var heatpoint_url = '{{ heatpoint_url | safe}}';
    var heatline_url = '{{ heatline_url | safe}}';
    var mapbox_accessToken = '{{ mapbox_accessToken|safe }}';
    var mapboxgl_accessToken = '{{ mapbox_gl_accessToken|safe }}';
    var ath_name = '{{ath_name}}';
    }
    catch (err) {
        console.log(err);
        $('#DownloadModal').modal("show");
    }

    $(document).ready(function() {
        $('#sidebar').swipe({
            swipeLeft:function() {
                $('#sidebar').toggle();
                map.resize();
                return false;
            }
        });
        $('#sidebar').swipe({
            swipeRight:function() {
                $('#sidebar').hide();
                map.resize();
                return false;
            }
        });
    });

    $("#sidebar-toggle-btn").click(function() {
        $("#sidebar").toggle();
        map.resize();
        return false;
    });

    $("#sidebar-hide-btn").click(function() {
        $('#sidebar').hide();
        map.resize();
        return false;
    });

    function copyToClipboard(text) {
        window.prompt("A link to your AthleteDataViz design:", text);
    }
    
    </script>
    <script type="text/javascript" src="/static/js/upload_img.js"></script>
    <script type="text/javascript" src="/static/js/image_gl_canvas.js"></script>
    <script type="text/javascript" src="/static/js/adv_viz_designer.js"></script>
    
    {% endblock %}
