<!DOCTYPE html>
<html>
  <head>
    <title>Athlete Data Viz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" media="screen">

    <style>
        .container {
          max-width: 800px;
        }
        body {
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        color: #000000;
        font-size: 13px;
        background-color: #D8D8D8;
        line-height: 1.5em;
        margin: 30px auto;
        padding: 0 50px;
        }
    </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/nanobar/0.2.1/nanobar.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">

    $( document ).ready(
        function(){
        $('.bikes').on('click','.radio-button',function () {
          $('.bikes .radio-button').removeClass('selected');
          $(this).addClass('selected')
          });
        }
    );

    $( document ).ready(
        function(){
        $('.activities').on('click','.radio-button',function () {
          $('.activities .radio-button').removeClass('selected');
          $(this).addClass('selected')
          });
        }
    );

    $( document ).ready(
        function(){
        $('.shoes').on('click','.radio-button',function () {
          $('.shoes .radio-button').removeClass('selected');
          $(this).addClass('selected')
          });
        }
    );

    function confirmDelete() {
      var x;
      if (confirm("Are you sure you want to delete all activities?") == true) {
        x = "Are you sure";
      } else {
        x = "You pressed Cancel!";
      }
      document.getElementById("delete_acts").innerHTML = x;
    }

    </script>
  </head>
  <body>
    {% block body %}

    <div class="container">
      <div class="row">
        <div class="col-md col-sm-offset-1">
          
        <div id="header">
          <h1>Athlete Data Viz</h1>
        </div>

        <div id= "col-xs col-sm-offset-1">
          <a href="{{ url_for('logout') }}" class="close button">Log out</a>
        </div>

        <div class="col-md col-sm-offset-1">
          <div id="greeting">
          <h2>Hello {{ athlete.firstname }} </h2>
          <p>
          This is Athlete Data Viz beta. Making your data into art.<br><br>
          1)  Enter the # of rides you want to vizualize below (1 - 500), then click "Update"<br>
          2)  Click "Get your last X Activities from Strava!" to begin the download!<br>
          3)  Wait for the progress bar to reach 100% <br>
          3)  View your viz by clicking "View Map!"<br>
          4)  To order your map, click "Order Viz!" <br>
          5)  Email AthleteDataViz@gmail.com with any bugs. <br> <br>
          </p>
        </div>
<!--
      <div class="section" id="activities">
        <h3 class="marginless">Available Strava Activity Count</h3>
        <table class="activity list">
          <thead style="">
            <tr>
              <th style="width: 20%">Name</th>
              <th style="width: 20%">Distance (mi)</th>
            </tr>
          </thead>
          <tbody>

          {% for activity in client.get_activities(limit=2) %}
          <tr class="{{'%s' % 'default' if activity.name}}" data-id="{{activity.name}}">
          <td>{{ activity.name }}</td>
          <td>
            <a class="radio-button {{'%s' % 'selected' if activity.name}}" data-id="{{activity.name}}"></a>
          </td>
          <td>{{ activity.distance*0.000621371 }}</td>
          </tr>
          {% else %}
          <tr><td>None!</td></tr>
          {% endfor %}
          </tbody>
        </table>
-->


      <div id="act_limit">
        <form action="act_limit" method="POST">
          <p><strong> How many activities do you want to download? (1-500) </strong> </p>
          <input type="number" name="act_limit" min="1" max="500" value="{{ act_limit }}">
          <input type="submit" class="btn btn-primary" value="Update!">
        </form>
      </div>
      {% for message in get_flashed_messages() %}
      <div class="container">
      <div  class="col-xs">
      <div class="alert alert-success" ng-show="get_flashed_messages() != null">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>
          <p style="color: red;">{{ message }}</p>
          </strong>
     </div>
     </div>
     </div>
     {% endfor %}

      <!--
      <div id="stravaData">
        <form action="stravaData" method="POST">
          <input type="hidden" name="act_limit" value="{{ act_limit }}" />
          <input type="submit" name="submit" value="Download {{ act_limit }} Activities?">
        </form>
      </div>
      !-->
      <br>
      <div id="Start Job">
        <button id="start-bg-job" class="btn btn-primary">  Get your last {{ act_limit }} Activities from Strava! </button>
      </div>
      <div class="container-fluid">
        <div id="progress">&nbsp; </div>
      </div>
      
      <script>
      function start_long_task() {
              // add task status elements
              div = $('<div class="progress"><div></div><div>0%</div><div>...</div><div>&nbsp;</div></div><hr>');
              $('#progress').append(div);

              // create a progress bar
              var nanobar = new Nanobar({
                  bg: '#44f',
                  target: div[0].childNodes[0]
              });

              // send ajax POST request to start background job
              $.ajax({
                  type: 'POST',
                  url: '/longtask',
                  success: function(data, status, request) {
                      status_url = request.getResponseHeader('Location');
                      update_progress(status_url, nanobar, div[0]);
                  },
                  error: function() {
                      alert('Unexpected error');
                  }
              });
          }
          function update_progress(status_url, nanobar, status_div) {
              // send GET request to status URL
              $.getJSON(status_url, function(data) {
                  // update UI
                  percent = parseInt(data['current'] * 100 / data['total']);
                  nanobar.go(percent);
                  $(status_div.childNodes[1]).text(percent + '%');
                  $(status_div.childNodes[2]).text(data['status']);
                  if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                      if ('result' in data) {
                          // show result
                          $(status_div.childNodes[3]).text('Result: ' + data['result']);
                      }
                      else {
                          // something unexpected happened
                          $(status_div.childNodes[3]).text('Result: ' + data['state']);
                      }
                  }
                  else {
                      // rerun in 2 seconds
                      setTimeout(function() {
                          update_progress(status_url, nanobar, status_div);
                      }, 1500);
                  }
              });
          }
          $(function() {
              $('#start-bg-job').click(start_long_task);
          });
      </script>

          

    <div id="view_map">
        <form action="strava_mapbox" method="GET">
          <input type="submit" name="submit" class="btn btn-success" value="View Map">
        </form>
    </div>

     <br><br>

    
    <div id="delete_acts">
      <form action="delete_acts" method="POST" onsubmit="return confirm('Comfirm Deletion? - This cannot be undone!');">
      <input type="submit" name="submit" class="btn btn-danger" value="Delete all my Activities">
      </form>
    </div>
    </a>
  </p>
</div>



<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
{% endblock %}
</html>

